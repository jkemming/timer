<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Room [[${room.name}]]</title>
</head>
<body>
 <h1>Room [[${room.name}]]</h1>
 <ul>
   <li th:each="timerRequest:${room.timerRequests}">[[${timerRequest}]]</li>
   <div id="timer"></div>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
   <script type="text/javascript">
     // Declare an EventSource
     let url = '/best/sse';
     console.log('setting up event source at ' + url);
     const eventSource = new EventSource(url);
     // Handler for events without an event type specified
     eventSource.onopen = () => {
       console.log('open');
     };
     eventSource.onerror = (e) => {
       console.log('onerror');
     };

     var timerDiv = document.getElementById('timer');
     eventSource.addEventListener('TIMER_UPDATE', (e) => {
       console.log('TIMER_UPDATE');
       timerDiv.innerHTML = e.data;
     });
     eventSource.addEventListener('TIMER_FINISHED', (e) => {
       console.log('TIMER_FINISHED');
       Notification.requestPermission();
       new Notification('mob next', {
         tag: 'timer-finished',
         silent: false,
         body: "Time's up.",
         lang: 'en',
       })
       new Howl({
         src: ['/mobnext.mp3']
       }).play();
     });
   </script>
 </ul>
</body>
</html>